# BERT Censorship Service

## Оглавление
1. [Описание проекта](#описание-проекта)
2. [Архитектура](#архитектура)
3. [Сервисы](#сервисы)
4. [Начало работы](#начало-работы)
5. [API Documentation](#api-documentation)
6. [Разработка](#разработка)

## Описание проекта

**BERT Censorship Service** — это инструмент, разработанный для обеспечения безопасности и конфиденциальности при использовании языковых моделей. Он выполняет несколько ключевых функций:
- Фильтрация контента;
- Защита конфиденциальности;
- Соблюдение нормативных требований.

## Архитектура

### Структура проекта
```
BERT-Censorship/
├── app/
│   ├── api/
│   │   ├── health.py           # Эндпоинт для проверки работоспособности сервиса
│   │   └── route.py            # Эндпоинты для работы с предсказаниями
│   ├── config.py               # Конфигурация приложения и настройка окружения
│   ├── core/
│   │   └── middleware.py       # Middleware для логирования запросов
│   ├── main.py                 # Точка входа приложения
│   ├── models/
│   │   ├── bert.py             # Реализация BERT модели для предсказаний
│   │   └── schemas.py          # Pydantic схемы для валидации запросов и ответов
│   └── services/
│       └── bert_service.py     # Сервис для работы с моделью BERT
├── requirements.txt            # Список зависимостей проекта
└── README.md                   # Документация проекта
```

### Технологический стек
- **Python 3.7+**
- **FastAPI** – для создания REST API
- **Pydantic** – для валидации данных и настроек
- **Transformers (HuggingFace)** – для работы с моделью BERT
- **PyTorch** – для выполнения инференса модели
- **Uvicorn** – ASGI сервер

## Сервисы
Сервис **BERT Censorship** предоставляет следующие функциональные возможности:

- **Health Check Service** (порт по умолчанию: 8000)
  - Эндпоинт `/health` для проверки работоспособности сервиса.

- **Prediction Service**
  - Эндпоинт `/api/v1/predict` для получения предсказаний модели BERT.
  - Принимает запросы с текстами (в формате JSON) и возвращает предсказанный класс с указанием уверенности модели.

## Начало работы

### Предварительные требования
- Python 3.7 или выше
- Установленные зависимости (см. файл `requirements.txt`)
- Локальная установка модели BERT:

  1. Скачать веса и необходимые файлы модели с [Hugging Face](https://huggingface.co/apanc/russian-sensitive-topics).
  2. Переместить скачанные файлы в папку `BERT`, так чтобы в итоге структура выглядела следующим образом:

  ```
  BERT-Censorship/
  ├── BERT/
  │   ├── config.json
  │   ├── id_topic.json
  │   ├── pytorch_model.bin
  │   ├── tokenizer_config.json
  │   ├── vocab.txt
  ├── app/
  ├── requirements.txt
  ├── README.md
  ```

  Эти файлы необходимы для корректной работы модели BERT в сервисе

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Запуск сервиса
Запустить сервис можно с помощью **uvicorn**:
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```
Параметр `--reload` активирует автоматическую перезагрузку сервиса при изменениях в коде (подходит для разработки).

## API Documentation
После запуска сервиса документация доступна по адресу:
- [Swagger UI](http://localhost:8000/docs)
- [ReDoc](http://localhost:8000/redoc)

Основные эндпоинты:
- **Health Check:** `GET /health`  
  _Пример ответа:_ `{"status": "healthy"}`

- **Prediction:** `POST /api/v1/predict`  
  _Тело запроса (JSON):_
  ```json
    curl -X POST http://localhost:8000/api/v1/predict \
        -H "Content-Type: application/json" \
        -d '{"texts": ["Эти тупые жирные шмары должны худеть!"]}'
  ```
  _Пример ответа:_
  ```json
    {"prediction":"телесный шейминг","confidence":0.32777947187423706}%
  ```

## Разработка

### Структура кода
- **app/config.py**  
  Содержит класс настроек приложения с возможностью переопределения через переменные окружения.

- **app/main.py**  
  Точка входа приложения. Здесь происходит настройка FastAPI, подключение маршрутов и событий жизненного цикла (startup/shutdown).

- **app/api/**  
  Содержит API эндпоинты:
  - `health.py` – эндпоинт для проверки состояния сервиса.
  - `route.py` – эндпоинт для получения предсказаний.

- **app/core/middleware.py**  
  Реализует middleware для логирования входящих запросов и времени их обработки.

- **app/models/**  
  - `bert.py` – логика работы с моделью BERT: загрузка модели, токенизация, получение предсказаний и обработка результатов.
  - `schemas.py` – схемы запросов и ответов, а также конфигурация модели с использованием Pydantic.

- **app/services/bert_service.py**  
  Сервисный слой для работы с моделью BERT, включающий инициализацию модели и метод получения предсказаний.

### Конвенции кода
- Применяется типизация Python и PEP 8.
- Валидация данных осуществляется с помощью Pydantic.
- Используются асинхронные вызовы (async/await) для повышения производительности.
- Документация к публичным методам и классам оформлена в виде docstrings.